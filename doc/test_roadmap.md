# テスト改善ロードマップ

このドキュメントでは、情報収集エージェントのテスト品質向上のための今後の計画と実施ステップを詳細に定義します。

## 1. 短期的課題（1〜2週間以内）

### 1.1 型の不一致の解消

| 項目 | 詳細 | 優先度 | 工数見積もり |
|-----|------|-------|------------|
| SearchResult型の整合性確保 | BaseModelクラスとSearchResult型の定義の不一致を解消する | 高 | 4時間 |
| ErrorCode列挙値の統一 | 古いエラーコード(AI_MODEL_ERRORなど)を新しい定義(MODEL_ERROR)に更新 | 高 | 2時間 |
| 設定ファイル構造の整理 | default.yml、config-schema.ts、selector.tsの不整合を解消 | 中 | 6時間 |

### 1.2 既存テストの改善

| 項目 | 詳細 | 優先度 | 工数見積もり |
|-----|------|-------|------------|
| テストヘルパー関数の作成 | テスト間で共通して使用するモック設定やセットアップ関数の整理 | 中 | 3時間 |
| テストコードのリファクタリング | 重複部分の削除と共通パターンの抽出 | 低 | 5時間 |
| テストの読みやすさ向上 | コメント追加とテストケースのグループ化 | 低 | 2時間 |

## 2. 中期的課題（1ヶ月以内）

### 2.1 テストカバレッジの向上

| 項目 | 詳細 | 優先度 | 工数見積もり |
|-----|------|-------|------------|
| モデル関連のテスト | BaseModelとAnthropicModelのテスト実装 | 高 | 8時間 |
| 設定ローダーのテスト | ConfigLoaderクラスのテスト実装 | 中 | 4時間 |
| ロガーのテスト | Loggerクラスとログレベルのテスト実装 | 中 | 4時間 |
| インデックスファイルのテスト | index.ts のコマンドライン引数処理などのテスト実装 | 低 | 6時間 |

### 2.2 システムテストの実装

| 項目 | 詳細 | 優先度 | 工数見積もり |
|-----|------|-------|------------|
| E2Eシナリオテスト | 実際のクエリから結果取得までの一連のフロー検証 | 高 | 16時間 |
| モック検索サーバー構築 | テスト用の検索APIモックサーバーの実装 | 中 | 8時間 |
| エラーシナリオテスト | ネットワークエラー、APIエラー等の異常系テスト | 高 | 8時間 |

## 3. 長期的課題（3ヶ月以内）

### 3.1 テスト自動化の強化

| 項目 | 詳細 | 優先度 | 工数見積もり |
|-----|------|-------|------------|
| CI/CDパイプラインの構築 | GitHub Actionsを使ったテスト自動実行環境の整備 | 高 | 16時間 |
| テストレポート自動生成 | テスト実行結果とカバレッジレポートの自動生成 | 中 | 8時間 |
| テストデータの自動更新 | モックデータや設定ファイルの定期的な更新の仕組み | 低 | 8時間 |

### 3.2 高度なテストの導入

| 項目 | 詳細 | 優先度 | 工数見積もり |
|-----|------|-------|------------|
| パフォーマンステスト | 大量データ処理時の性能測定とボトルネック特定 | 中 | 16時間 |
| セキュリティテスト | APIキー管理やデータ保護のセキュリティ検証 | 高 | 12時間 |
| ロケーション/国際化テスト | 異なる言語・地域での動作検証 | 低 | 8時間 |

## 4. テスト改善マイルストーン

### フェーズ1: 基盤強化（〜4週目）
- 型の不一致解消
- モデル関連テスト実装
- 設定ローダー・ロガーテスト実装
- テストヘルパー整備

### フェーズ2: システムテスト導入（5〜8週目）
- E2Eシナリオテスト実装
- エラーシナリオテスト実装
- モック検索サーバー構築
- CI基本設定

### フェーズ3: 自動化・高度化（9〜12週目）
- CI/CDパイプライン完成
- パフォーマンステスト実装
- セキュリティテスト実装
- テストレポート自動化

## 5. メトリクス・目標値

| メトリクス | 現状 | 目標（短期） | 目標（長期） |
|----------|------|------------|------------|
| ステートメントカバレッジ | 62.76% | 80% | 90% |
| ブランチカバレッジ | 51.28% | 70% | 85% |
| 関数カバレッジ | 73.33% | 85% | 95% |
| テスト実行時間 | 約14秒 | <20秒 | <30秒 |
| 障害検出率 | 未測定 | 70% | 90% |

## 6. テスト改善の責任分担

| 領域 | 担当者 | レビュワー |
|-----|-------|----------|
| 単体テスト | 開発者 | テストリーダー |
| 統合テスト | 開発者 | テストリーダー |
| システムテスト | テストエンジニア | プロジェクトリーダー |
| テスト自動化 | DevOpsエンジニア | テストリーダー |
| パフォーマンステスト | パフォーマンスエンジニア | アーキテクト |

## 7. リスクと対策

| リスク | 影響度 | 発生確率 | 対策 |
|-------|-------|---------|-----|
| テスト環境の不安定さ | 高 | 中 | 専用のテスト環境を構築し、本番環境と分離する |
| テスト実行時間の増加 | 中 | 高 | テストの並列実行対応とスナップショットテストの導入 |
| 外部APIの依存性 | 高 | 高 | モックサーバーの強化と定期的な実API確認の自動化 |
| テスト保守の複雑化 | 中 | 中 | テストコードのモジュール化と共通ライブラリの整備 | 